<head>
  <style>
@import url('https://fonts.googleapis.com/css?family=Ubuntu+Mono');

body {
     margin: 0px;
     background-color: rgb(233, 218, 195);
     color: #381d26;
     font-family: 'ubuntu mono';
     font-size: 17px;
     font-weight: 600;
     overflow-y: auto;
}

.white {
     margin: 50px;
     background: hsl(36, 60%, 90%);
     border-radius: 25px;
     padding: 50px;
     padding-top: 25px;
     padding-bottom: 25px;
}

p {
     text-align: center;
}

a {
     color: #bc9e6b;
}

select {
     height: 21.25px;
     font-family: 'ubuntu mono';
     text-transform: capitalize;
}

.parents input[type='checkbox'] {
     margin: -10px;
     margin-left: 5px;
     padding: 0px;
     vertical-align: middle;
     height: 16px;
     width: 16px;
}

.inputs select {
     margin: 5px;
     float: right;
     width: 100px;
     overflow: auto;
}

#inputcontainer {
     margin: auto;
     width: 750px;
     display: flex;
     justify-content: center;
}

.inputs {
     width: 40%;
     min-width: ;
     max-width: ;
     font-size: 15px;
     padding: 25px;
}

.inputs label {
     line-height: 32px;
}

.inputs input {
     width: 86px;
     height: 15px;
     padding: 0;
     margin: 0;
     margin-right: 5px;
     vertical-align: middle;
     position: relative;
     top: 10px;
     float: right;
}

.parents {
     clear: left;
     text-align: center;
}

.foalOutput {
     text-align: center;
     white-space: pre-line;
     font-weight: 900;
     font-size: 19px;
}

button {
     background-color: #381d26;
     border: none;
     color: #e2c491;
     padding: 10px 25px;
     text-align: center;
     display: inline-block;
     font-family: 'ubuntu mono';
     font-size: 16px;
}

button:hover {
     background-color: #663764;
     color: #e2c491;
}

button:active {
     filter: brightness(115%);
}

button:focus {
     outline: 0;
}

</style>
</head>

<body>
  <div id="container">
    <div class="white">
      <div>
        <div id="inputcontainer">
          <div class="inputs">
            <label for="tarotcard">Tarot Cards
              <select id="tarotCard">
                <option value="n/a">n/a</option>
              </select>
            </label>
            <br><label for="furcloak">Ceremonial Fur Cloak
              <select id="furCloak">
                <option value="n/a">n/a</option>
              </select>
            </label>
            <br><label for="rainbowcham">Rainbow Chameleon<input type="text" id="rainbowChameleon" placeholder="[mutations]">
            </select></label>
            <br><label for="riderrank">Rider Rank
              <select id="rankRider">
              </select>
            </label>
			<br><label>Heirloom Curry Comb <input type="checkbox" id="heirloomCurryComb"></label>
            <br><label for="horserank">Horse Rank
              <select id="rankHorse">
              </select>
            </label>
			<br><label for="fertilitysup">Fertility Supplement <input type="checkbox" id="fertilitySupplement"></label>
            <br><label for="ringOfBlessings">Ring Of Blessings <input type="checkbox" id="ringOfBlessings"></label>
            <!-- <br><label for="novicetwins">Novice Rolling Twins <input type="checkbox" id="noviceTwins"></label> -->
            <br><label for="tortoisecomp">Tortoise Companion <input type="checkbox" id="tortoiseCompanion"></label>
          </div>

          <div class="inputs">
             <label for="pendantancestors">Pendant Of The Ancestors <input type="checkbox" id="pendantOfTheAncestors"></label>
			<br><label for="buildItems">Build Items
              <select id="buildItems">
              </select>
            </label>
            <br><label>Charm Of Success <input type="checkbox" id="charmOfSuccess"></label>
            <br><label>Charm Of Health <input type="checkbox" id="charmOfHealth"></label>
            <br><label>Charm Of Fortune <input type="checkbox" id="charmOfFortune"></label>
			<br><label>Ceremonial Belt
              <select id="ceremonialBelt">
                <option value="n/a">n/a</option>
              </select>
            </label>
            <br><label>Ceremonial Mask
              <select id="ceremonialMask">
                <option value="n/a">n/a</option>
              </select>
            </label>
			<br><label>Ceremonial Headpiece
              <select id="ceremonialHeadpiece">
                <option value="n/a">n/a</option>
              </select>
            </label>
            <br><label>Mysterious Mixture <input type="checkbox" id="mysteriousMixture"></label>
          </div>
        </div>

        <div class="parents">
          Inbred Foal? <input type="checkbox" id="inbredGet"></input>
          <br>
          <br><b>SIRE: </b><input type="text" id="sireget" placeholder=" geno"></input></select><input type="text" id="sirestatget" placeholder=" stats" size="10"></input><select id="sireType">
          </select>
          <br><b>DAM:  &nbsp;</b><input type="text" id="damget" placeholder=" geno"></input><input type="text" id="damstatget" placeholder=" stats" size="10"></input><select id="damType">
          </select><br><br>
          <button onclick="buttonPress()"><b>ROLL</b></button>
          <br><br></div>

          <div class="foalOutput" id="foalOutput1">
          </div>
          <div class="foalOutput" id="foalOutput2">
          </div>

          <!--<br>
          <p>This roller is for the <a href="https://www.deviantart.com/moren-ezen/">Moren Ezen</a> group.<br>If you would like to purchase a customized geno-roller,<br>contact MiscNapier at thatnapier95@gmail.com or on <a href="http://miscnapier.deviantart.com/">DeviantART</a>.</p>-->
        </div>

      </div>
    </div>

  </body>

  <script>
/* jshint esversion: 6 */

// Snippets
// .replace(/(,\s)(?!.*\1)/, ' and ') <-- find last instance

function browserCheck() {
     const isChrome = !window.chrome;
     if (isChrome === false) {
          browser.style.display = 'none';
     }
}

function populate(id, array, optGroup) {
     if (optGroup === false) {
          let select = document.getElementById(id);
          let options = array;

          for (let i = 0; i < options.length; i++) {
               let opt = options[i];
               let ele = document.createElement('option');
               ele.textContent = opt;
               ele.value = opt;
               select.appendChild(ele);
          }
     } else {
          let select = document.getElementById(id);
          let groups = Object.keys(array);
          // console.log(groups);

          for (let i = 0; i < groups.length; i++) {
               let gro = groups[i];
               let groEle = document.createElement('optgroup');
               groEle.label = gro;
               select.appendChild(groEle);

               let options = array[gro];
               for (let i = 0; i < options.length; i++) {
                    let opt = options[i][0];
                    let ele = document.createElement('option');
                    ele.textContent = opt;
                    ele.value = opt;
                    select.appendChild(ele);
               }
          }
     }
}

function reload() {
     window.location.reload(false);
}

function rng(max) {
     const rng = Math.floor(Math.random() * max) + 1;
     return rng;
}

function rngRange(min, max) {
     const rng = Math.floor(Math.random() * (max - min + 1)) + min;
     return rng;
}

function randomizer(array) {
     if (array.length > 0) {
          const random = array[Math.floor(Math.random() * array.length)];
          return random;
     } else {
          return '';
     }
}

function onlyUnique(value, index, self) {
     return self.indexOf(value) === index;
}
// let a = ['a', 1, 'a', 2, '1'];
// let unique = a.filter( onlyUnique ); // returns ['a', 1, 2, '1']

function combiner(array) {
     const result = [],
          f = function (prefix = [], array) {
               for (let i = 0; i < array.length; i++) {
                    result.push([...prefix, array[i]]);
                    f([...prefix, array[i]], array.slice(i + 1));
               }
          };
     f('', array);
     return result;
}

function capitalizeArr(array) {
     var newArray = [];

     for (var x = 0; x < array.length; x++) {
          newArray.push(array[x].charAt(0).toUpperCase() + array[x].slice(1));
     }
     return newArray;
}

String.prototype.capitalizeStr = function () {
     // TODO: capitalize no worky with opening parenthesis even though regexr says it should?
     return this.replace(/(?:^|\(|\s|-|\/)\S/g, function (a) {
          return a.toUpperCase();
     });
};
// string.capitalize();

// const arrayToSort = ['apple', 'banana', 'cherry', 'date'];
// const sortOrder = ['banana', 'date', 'apple', 'cherry'];
// const sortedArray = arrayToSort.sortByArray(sortOrder);
// console.log(sortedArray);
Array.prototype.sortByArray = function (orderArr) {
     const map = new Map();
     orderArr.forEach((val, index) => map.set(val, index));
     return this.sort((a, b) => map.get(a) - map.get(b));
};

Array.prototype.checkGene = function (geneRegex) {
     return this.some((x) => geneRegex.test(x));
};

function charmOfHealthDowngrade(pathGeno, dom, rec) {
     // Charm of Health: downgrade dominant genes to heterozygous
     if (charmOfHealthTriggered && pathGeno.rarities.includes(dom)) {
          // Find and replace dominant with recessive
          let domIndex = pathGeno.rarities.indexOf(dom);
          if (domIndex !== -1) {
               pathGeno.rarities[domIndex] = rec;
          }
     }
}

</script>
  <script>
const dictAgouti = [
     // ['parent1', 'parent2', ['possibilities...']],
     ['aa', 'aa', ['aa']],
     ['aa', 'Aa', ['aa', 'Aa']],
     ['aa', 'AA', ['aa', 'Aa', 'AA']],
     ['aa', 'Ata', ['aa', 'Aa', 'Ata']],
     ['aa', 'AtA', ['aa', 'Aa', 'AA', 'Ata', 'AtA', 'AAt']],
     ['aa', 'AAt', ['aa', 'Aa', 'AA', 'Ata', 'AtA', 'AAt']],
     ['aa', 'AtAt', ['aa', 'Aa', 'AA', 'Ata', 'AtA', 'AAt', 'AtAt']],
     ['aa', 'Awa', ['aa', 'Aa', 'Awa']],
     ['aa', 'AwA', ['aa', 'Aa', 'AA', 'Awa', 'AwA', 'AAw']],
     ['aa', 'AAw', ['aa', 'Aa', 'AA', 'Awa', 'AwA', 'AAw']],
     ['aa', 'AwAw', ['aa', 'Aa', 'AA', 'Awa', 'AwA', 'AAw', 'AwAw']],
     [
          'aa',
          'AtAw',
          [
               'aa',
               'Aa',
               'AA',
               'Ata',
               'AtA',
               'AAt',
               'Awa',
               'AwA',
               'AAw',
               'AtAw',
               'AwAt',
          ],
     ],
     [
          'aa',
          'AwAt',
          [
               'aa',
               'Aa',
               'AA',
               'Ata',
               'AtA',
               'AAt',
               'Awa',
               'AwA',
               'AAw',
               'AtAw',
               'AwAt',
          ],
     ],
     ['Aa', 'Aa', ['aa', 'Aa', 'AA']],
     ['Aa', 'AA', ['Aa', 'AA']],
     ['Aa', 'Ata', ['aa', 'Aa', 'AA', 'Ata', 'AtA']],
     ['Aa', 'AtA', ['Aa', 'AA', 'Ata', 'AtA', 'AAt']],
     ['Aa', 'AAt', ['Aa', 'AA', 'Ata', 'AtA', 'AAt']],
     ['Aa', 'AtAt', ['Aa', 'AA', 'Ata', 'AtA', 'AAt', 'AtAt']],
     ['Aa', 'Awa', ['aa', 'Aa', 'AA', 'Awa', 'AwA', 'AAw']],
     ['Aa', 'AwA', ['Aa', 'AA', 'Awa', 'AwA', 'AAw']],
     ['Aa', 'AAw', ['Aa', 'AA', 'Awa', 'AwA', 'AAw']],
     ['Aa', 'AwAw', ['Aa', 'AA', 'Awa', 'AwA', 'AAw', 'AwAw']],
     [
          'Aa',
          'AtAw',
          [
               'Aa',
               'AA',
               'Ata',
               'AtA',
               'AAt',
               'Awa',
               'AwA',
               'AAw',
               'AtAw',
               'AwAt',
          ],
     ],
     [
          'Aa',
          'AwAt',
          [
               'Aa',
               'AA',
               'Ata',
               'AtA',
               'AAt',
               'Awa',
               'AwA',
               'AAw',
               'AtAw',
               'AwAt',
          ],
     ],
     ['AA', 'AA', ['AA']],
     ['AA', 'Ata', ['Aa', 'AA', 'Ata', 'AtA', 'AAt']],
     ['AA', 'AtA', ['AA', 'Ata', 'AtA', 'AAt']],
     ['AA', 'AAt', ['AA', 'Ata', 'AtA', 'AAt']],
     ['AA', 'AtAt', ['AA', 'AtA', 'AAt', 'AtAt']],
     ['AA', 'Awa', ['Aa', 'AA', 'Awa', 'AwA', 'AAw']],
     ['AA', 'AwA', ['AA', 'Awa', 'AwA', 'AAw']],
     ['AA', 'AAw', ['AA', 'Awa', 'AwA', 'AAw']],
     ['AA', 'AwAw', ['AA', 'AwA', 'AAw', 'AwAw']],
     [
          'AA',
          'AtAw',
          ['AA', 'Ata', 'AtA', 'AAt', 'Awa', 'AwA', 'AAw', 'AtAw', 'AwAt'],
     ],
     [
          'AA',
          'AwAt',
          ['AA', 'Ata', 'AtA', 'AAt', 'Awa', 'AwA', 'AAw', 'AtAw', 'AwAt'],
     ],
     ['Ata', 'Ata', ['aa', 'Aa', 'AA', 'Ata', 'AtA', 'AAt', 'AtAt']],
     ['Ata', 'AtA', ['Aa', 'AA', 'Ata', 'AtA', 'AAt', 'AtAt']],
     ['Ata', 'AAt', ['Aa', 'AA', 'Ata', 'AtA', 'AAt', 'AtAt']],
     ['Ata', 'AtAt', ['Aa', 'AA', 'Ata', 'AtA', 'AAt', 'AtAt']],
     [
          'Ata',
          'Awa',
          [
               'aa',
               'Aa',
               'AA',
               'Ata',
               'AtA',
               'AAt',
               'Awa',
               'AwA',
               'AAw',
               'AtAw',
               'AwAt',
          ],
     ],
     [
          'Ata',
          'AwA',
          [
               'Aa',
               'AA',
               'Ata',
               'AtA',
               'AAt',
               'Awa',
               'AwA',
               'AAw',
               'AtAw',
               'AwAt',
          ],
     ],
     [
          'Ata',
          'AAw',
          ['Aa', 'AA', 'Ata', 'AtA', 'AAt', 'Awa', 'AwA', 'AAw', 'AtAw'],
     ],
     [
          'Ata',
          'AwAw',
          [
               'Aa',
               'AA',
               'Ata',
               'AtA',
               'AAt',
               'Awa',
               'AwA',
               'AAw',
               'AwAw',
               'AtAw',
               'AwAt',
          ],
     ],
     [
          'Ata',
          'AtAw',
          [
               'Aa',
               'AA',
               'Ata',
               'AtA',
               'AAt',
               'AtAt',
               'Awa',
               'AwA',
               'AAw',
               'AtAw',
               'AwAt',
          ],
     ],
     [
          'Ata',
          'AwAt',
          [
               'Aa',
               'AA',
               'Ata',
               'AtA',
               'AAt',
               'AtAt',
               'Awa',
               'AwA',
               'AAw',
               'AtAw',
               'AwAt',
          ],
     ],
     ['AtA', 'AtA', ['AA', 'AtA', 'AAt', 'AtAt']],
     ['AtA', 'AAt', ['AA', 'AtA', 'AAt', 'AtAt']],
     ['AtA', 'AtAt', ['AA', 'AtA', 'AAt', 'AtAt']],
     [
          'AtA',
          'Awa',
          [
               'Aa',
               'AA',
               'Ata',
               'AtA',
               'AAt',
               'Awa',
               'AwA',
               'AAw',
               'AtAw',
               'AwAt',
          ],
     ],
     ['AtA', 'AwA', ['AA', 'AtA', 'AAt', 'AwA', 'AAw', 'AtAw', 'AwAt']],
     ['AtA', 'AAw', ['AA', 'AtA', 'AAt', 'AwA', 'AAw', 'AtAw', 'AwAt']],
     [
          'AtA',
          'AwAw',
          ['AA', 'AtA', 'AAt', 'AwA', 'AAw', 'AwAw', 'AtAw', 'AwAt'],
     ],
     [
          'AtA',
          'AtAw',
          ['AA', 'AtA', 'AAt', 'AtAt', 'AwA', 'AAw', 'AtAw', 'AwAt'],
     ],
     [
          'AtA',
          'AwAt',
          ['AA', 'AtA', 'AAt', 'AtAt', 'AwA', 'AAw', 'AtAw', 'AwAt'],
     ],
     ['AAt', 'AAt', ['AA', 'AtA', 'AAt', 'AtAt']],
     ['AAt', 'AtAt', ['AA', 'AtA', 'AAt', 'AtAt']],
     [
          'AAt',
          'Awa',
          [
               'Aa',
               'AA',
               'Ata',
               'AtA',
               'AAt',
               'Awa',
               'AwA',
               'AAw',
               'AtAw',
               'AwAt',
          ],
     ],
     ['AAt', 'AwA', ['AA', 'AtA', 'AAt', 'AwA', 'AAw', 'AtAw', 'AwAt']],
     ['AAt', 'AAw', ['AA', 'AtA', 'AAt', 'AwA', 'AAw', 'AtAw', 'AwAt']],
     [
          'AAt',
          'AwAw',
          ['AA', 'AtA', 'AAt', 'AwA', 'AAw', 'AwAw', 'AtAw', 'AwAt'],
     ],
     [
          'AAt',
          'AtAw',
          ['AA', 'AtA', 'AAt', 'AtAt', 'AwA', 'AAw', 'AtAw', 'AwAt'],
     ],
     [
          'AAt',
          'AwAt',
          ['AA', 'AtA', 'AAt', 'AtAt', 'AwA', 'AAw', 'AtAw', 'AwAt'],
     ],
     ['AtAt', 'AtAt', ['AA', 'AtA', 'AAt', 'AtAt']],
     [
          'AtAt',
          'Awa',
          [
               'Aa',
               'AA',
               'Ata',
               'AtA',
               'AAt',
               'AtAt',
               'Awa',
               'AwA',
               'AAw',
               'AtAw',
               'AwAt',
          ],
     ],
     [
          'AtAt',
          'AwA',
          ['AA', 'AtA', 'AAt', 'AtAt', 'AwA', 'AAw', 'AtAw', 'AwAt'],
     ],
     [
          'AtAt',
          'AAw',
          ['AA', 'AtA', 'AAt', 'AtAt', 'AwA', 'AAw', 'AtAw', 'AwAt'],
     ],
     [
          'AtAt',
          'AwAw',
          ['AA', 'AtA', 'AAt', 'AtAt', 'AwA', 'AAw', 'AwAw', 'AtAw', 'AwAt'],
     ],
     [
          'AtAt',
          'AtAw',
          ['AA', 'AtA', 'AAt', 'AtAt', 'AwA', 'AAw', 'AtAw', 'AwAt'],
     ],
     [
          'AtAt',
          'AwAt',
          ['AA', 'AtA', 'AAt', 'AtAt', 'AwA', 'AAw', 'AtAw', 'AwAt'],
     ],
     ['Awa', 'Awa', ['aa', 'Aa', 'AA', 'Awa', 'AwA', 'AAw', 'AwAw']],
     ['Awa', 'AwA', ['Aa', 'AA', 'Awa', 'AwA', 'AAw', 'AwAw']],
     ['Awa', 'AAw', ['Aa', 'AA', 'Awa', 'AwA', 'AAw', 'AwAw']],
     ['Awa', 'AwAw', ['Aa', 'AA', 'Awa', 'AwA', 'AAw', 'AwAw']],
     [
          'Awa',
          'AtAw',
          [
               'Aa',
               'AA',
               'Ata',
               'AtA',
               'AAt',
               'Awa',
               'AwA',
               'AAw',
               'AwAw',
               'AtAw',
               'AwAt',
          ],
     ],
     [
          'Awa',
          'AwAt',
          [
               'Aa',
               'AA',
               'Ata',
               'AtA',
               'AAt',
               'Awa',
               'AwA',
               'AAw',
               'AwAw',
               'AtAw',
               'AwAt',
          ],
     ],
     ['AwA', 'AwA', ['AA', 'AwA', 'AAw', 'AwAw']],
     ['AwA', 'AAw', ['AA', 'AwA', 'AAw', 'AwAw']],
     ['AwA', 'AwAw', ['AA', 'AwA', 'AAw', 'AwAw']],
     [
          'AwA',
          'AtAw',
          ['AA', 'AtA', 'AAt', 'AwA', 'AAw', 'AwAw', 'AtAw', 'AwAt'],
     ],
     [
          'AwA',
          'AwAt',
          ['AA', 'AtA', 'AAt', 'AwA', 'AAw', 'AwAw', 'AtAw', 'AwAt'],
     ],
     ['AAw', 'AAw', ['AA', 'AwA', 'AAw', 'AwAw']],
     ['AAw', 'AwAw', ['AA', 'AwA', 'AAw', 'AwAw']],
     [
          'AAw',
          'AtAw',
          ['AA', 'AtA', 'AAt', 'AwA', 'AAw', 'AwAw', 'AtAw', 'AwAt'],
     ],
     [
          'AAw',
          'AwAt',
          ['AA', 'AtA', 'AAt', 'AwA', 'AAw', 'AwAw', 'AtAw', 'AwAt'],
     ],
     ['AwAw', 'AwAw', ['AA', 'AwA', 'AAw', 'AwAw']],
     [
          'AwAw',
          'AtAw',
          ['AA', 'AtA', 'AAt', 'AwA', 'AAw', 'AwAw', 'AtAw', 'AwAt'],
     ],
     [
          'AwAw',
          'AwAt',
          ['AA', 'AtA', 'AAt', 'AwA', 'AAw', 'AwAw', 'AtAw', 'AwAt'],
     ],
     [
          'AtAw',
          'AtAw',
          ['AA', 'AtA', 'AAt', 'AtAt', 'AwA', 'AAw', 'AwAw', 'AtAw', 'AwAt'],
     ],
     [
          'AtAw',
          'AwAt',
          ['AA', 'AtA', 'AAt', 'AtAt', 'AwA', 'AAw', 'AwAw', 'AtAw', 'AwAt'],
     ],
     [
          'AwAt',
          'AwAt',
          ['AA', 'AtA', 'AAt', 'AtAt', 'AwA', 'AAw', 'AwAw', 'AtAw', 'AwAt'],
     ],
];

</script>
  <script>
/* jshint esversion: 6 */
// NOV 2019 REFACTOR

// geneArrays
// to add a gene, add ['colour', 'gene'] to the corresponding rarity array. Each gene in the array should be separated by a ','. The 'colour' should be all lowercase.
const genes = {
     common: [
          ['champagne', 'Ch'],
          ['cream', 'Cr'],
          ['dun', 'Dn'],
          ['pearl', 'Pr'],
          ['mushroom', 'Ms'],
          ['silver', 'Sv'],
          ['flaxen', 'Fl'],
          ['fryekli', 'Fr'],
          ['grey', 'Gr'],
          ['oduud', 'Od'],
          ['pangare', 'Pn'],
          ['rabicano', 'Rb'],
          ['sabino', 'Sb'],
          ['shield', 'Sh'],
          ['sable', 'Sl'],
          ['nightshade', 'Ns'],
          ['daybreak', 'Db'],
          ['khoshig', 'Ks'],
          ['seal', 'Sl'],
          ['tear', 'Tr'],
          ['tarnish', 'Tn'],
     ],
     uncommon: [
          ['leopard', 'Lp'],
          ['blanket', 'Bl'],
          ['chono', 'Cn'],
          ['shuvuu', 'Su'],
          ['overo', 'Ov'],
          ['roan', 'Rn'],
          ['sooty', 'St'],
          ['splash', 'Sp'],
          ['tobiano', 'To'],
          ['onoo', 'On'],
          ['eguskine', 'Eg'],
          ['aqmar', 'Aq'],
          ['earthen', 'Er'],
          ['giraffe', 'Gf'],
          ['maze', 'Mz'],
          ['rosettes', 'Rs'],
          ['viper', 'Vp'],
     ],
     rare: [
          ['mystic', 'My'],
          ['shavar', 'Sr'],
          ['takhÃ¶', 'Tk'],
          ['tsasan', 'Ts'],
          ['quagga', 'Qu'],
          ['marbled', 'Mb'],
          ['magebane', 'Mg'],
          ['brume', 'Br'],
     ],
};

function ceremonialMaskCleanup() {
     const select = document.getElementById('ceremonialMask');
     const valuesToRemove = ['overo'].concat(genes.rare.map((x) => x[0]));
     for (let i = select.options.length - 1; i >= 0; i--) {
          if (valuesToRemove.includes(select.options[i].value)) {
               select.remove(i);
          }
     }
     const optgroups = select.getElementsByTagName('optgroup');
     for (let i = 0; i < optgroups.length; i++) {
          if (optgroups[i].label === 'rare') {
               select.removeChild(optgroups[i]);
               break;
          }
     }
}

function ceremonialHeadpieceCleanup() {
     const select = document.getElementById('ceremonialHeadpiece');
     const valuesToRemove = ['overo'];
     for (let i = select.options.length - 1; i >= 0; i--) {
          if (valuesToRemove.includes(select.options[i].value)) {
               select.remove(i);
          }
     }
}

// populate dropdowns
populate('tarotCard', ['stallion', 'mare'], false);
populate('furCloak', genes, true);
populate('rankRider', ['untrained', 'initiate', 'rookie'], false);
populate('rankHorse', ['feral/companion', 'adept', 'veteran'], false);
populate('sireType', ['jibita pony', 'haspar draft', 'tatakh mini'], false);
populate('damType', ['jibita pony', 'haspar draft', 'tatakh mini'], false);
populate(
     'buildItems',
     ['none', 'light tonic', 'medium tonic', 'heavy tonic'],
     false
);
populate('ceremonialMask', genes, true);
populate('ceremonialHeadpiece', genes, true);

ceremonialMaskCleanup();
ceremonialHeadpieceCleanup();

// setup input objects, add event listener to inputs and update objects on change
function inputSetup() {
     window.input = {
          tarotCard: document.getElementById('tarotCard').value,
          furCloak: document.getElementById('furCloak').value,
          rainbowChameleon: {
               albino:
                    document
                         .getElementById('rainbowChameleon')
                         .value.search(/albino/i) !== -1
                         ? true
                         : false,
               melanistic:
                    document
                         .getElementById('rainbowChameleon')
                         .value.search(/melanistic/i) !== -1
                         ? true
                         : false,
               chimeric:
                    document
                         .getElementById('rainbowChameleon')
                         .value.search(/chimeric/i) !== -1
                         ? true
                         : false,
               brindle:
                    document
                         .getElementById('rainbowChameleon')
                         .value.search(/brindle/i) !== -1
                         ? true
                         : false,
               vitiligo:
                    document
                         .getElementById('rainbowChameleon')
                         .value.search(/vitiligo/i) !== -1
                         ? true
                         : false,
               somatic:
                    document
                         .getElementById('rainbowChameleon')
                         .value.search(/somatic/i) !== -1
                         ? true
                         : false,
               blizzard:
                    document
                         .getElementById('rainbowChameleon')
                         .value.search(/blizzard/i) !== -1
                         ? true
                         : false,
               paradox:
                    document
                         .getElementById('rainbowChameleon')
                         .value.search(/paradox/i) !== -1
                         ? true
                         : false,
               caramel:
                    document
                         .getElementById('rainbowChameleon')
                         .value.search(/caramel/i) !== -1
                         ? true
                         : false,
               marl:
                    document
                         .getElementById('rainbowChameleon')
                         .value.search(/marl/i) !== -1
                         ? true
                         : false,
          },
          rankRider: document.getElementById('rankRider').value,
          rankHorse: document.getElementById('rankHorse').value,
          fertilitySupplement: document.getElementById('fertilitySupplement')
               .checked,
          ringOfBlessings: document.getElementById('ringOfBlessings').checked,
          // noviceTwins: document.getElementById('noviceTwins').checked,
          tortoiseCompanion:
               document.getElementById('tortoiseCompanion').checked,
          pendantOfTheAncestors: document.getElementById(
               'pendantOfTheAncestors'
          ).checked,
          buildItems: document.getElementById('buildItems').value,
          heirloomCurryComb:
               document.getElementById('heirloomCurryComb').checked,
          charmOfSuccess: document.getElementById('charmOfSuccess').checked,
          charmOfHealth: document.getElementById('charmOfHealth').checked,
          charmOfFortune: document.getElementById('charmOfFortune').checked,
          ceremonialBelt: document.getElementById('ceremonialBelt').value,
          ceremonialMask: document.getElementById('ceremonialMask').value,
          ceremonialHeadpiece: document.getElementById('ceremonialHeadpiece')
               .value,
          mysteriousMixture:
               document.getElementById('mysteriousMixture').checked,
          inbred: document.getElementById('inbredGet').checked,
     };
}

function parentSetup() {
     window.sire = {
          geno: document
               .getElementById('sireget')
               .value.replace(/\//g, ' ')
               .replace(/w/g, 'w'),
          stats: document.getElementById('sirestatget').value,
          type: document.getElementById('sireType').value,
     };
     window.dam = {
          geno: document
               .getElementById('damget')
               .value.replace(/\//g, ' ')
               .replace(/w/g, 'w'),
          stats: document.getElementById('damstatget').value,
          type: document.getElementById('damType').value,
     };
}

function ceremonialBeltSetup() {
     function getBlack() {
          let sorted = ['E', 'e'];
          let regEx1 = /(E|e)(?=E|e)/;
          let regEx2 = /(?<=E|e)(E|e)/;

          let geneA =
               sire.geno.match(regEx1) !== null
                    ? sire.geno.match(regEx1)[0]
                    : 'e';
          let geneB =
               sire.geno.match(regEx2) !== null
                    ? sire.geno.match(regEx2)[0]
                    : 'e';
          let geneC =
               dam.geno.match(regEx1) !== null
                    ? dam.geno.match(regEx1)[0]
                    : 'e';
          let geneD =
               dam.geno.match(regEx2) !== null
                    ? dam.geno.match(regEx2)[0]
                    : 'e';
          return [geneA + geneC, geneB + geneC, geneA + geneD, geneB + geneD]
               .map((x) => x.split('').sortByArray(sorted).join(''))
               .filter(onlyUnique);
     }

     function getAgouti() {
          let sorted = ['A', 'At', 'Aw', 'a'];
          let regEx1 = /(A|At|Aw|a)(?=A|At|Aw|a)/;
          let regEx2 = /(?<=A|At|Aw|a)(A|At|Aw|a)/;

          let geneA =
               sire.geno.match(regEx1) !== null
                    ? sire.geno.match(regEx1)[0]
                    : 'a';
          let geneB =
               sire.geno.match(regEx2) !== null
                    ? sire.geno.match(regEx2)[0]
                    : 'a';
          let geneC =
               dam.geno.match(regEx1) !== null
                    ? dam.geno.match(regEx1)[0]
                    : 'a';
          let geneD =
               dam.geno.match(regEx2) !== null
                    ? dam.geno.match(regEx2)[0]
                    : 'a';
          return [
               [geneA, geneC],
               [geneB, geneC],
               [geneA, geneD],
               [geneB, geneD],
          ]
               .map((x) => x.sortByArray(sorted).join(''))
               .filter(onlyUnique);
     }

     let geno = { black: getBlack(), agouti: getAgouti() };
     console.log(geno);
     let output = [];
     if (
          geno.black.checkGene(/ee/) &&
          geno.agouti.checkGene(/(A|At|Aw|a)(A|At|Aw|a)/)
     ) {
          output.push('chestnut');
     }
     if (
          geno.black.checkGene(/E(E|e)/) &&
          geno.agouti.checkGene(/(AtAt|AtAw|Ata|AtA|AAt|AwAt)/)
     ) {
          output.push('mealy');
     }
     if (
          geno.black.checkGene(/E(E|e)/) &&
          geno.agouti.checkGene(/(AAw|AwA|Awa|AwAw)/)
     ) {
          output.push('wild bay');
          if (
               geno.black.checkGene(/E(E|e)/) &&
               geno.agouti.checkGene(/(A)(A|a)/)
          ) {
               output.push('bay');
          }
     }
     if (geno.black.checkGene(/E(E|e)/) && geno.agouti.checkGene(/aa/)) {
          output.push('black');
     }
     // console.log(geno, output);

     document.getElementById('ceremonialBelt').innerHTML = '';
     output.unshift('n/a');
     populate('ceremonialBelt', output, false);
}

let eleSelect = document.getElementsByTagName('select');
for (let i = 0; i < eleSelect.length; i++) {
     eleSelect[i].addEventListener('change', inputUpdate);
}

let eleInput = document.getElementsByTagName('input');
for (let i = 0; i < eleInput.length; i++) {
     eleInput[i].addEventListener('change', inputUpdate);
}
// console.log(eleSelect, eleInput);

// can't go in inputUpdate because then the selected option gets eaten :O)
document
     .getElementById('sireget')
     .addEventListener('change', ceremonialBeltSetup);
document
     .getElementById('damget')
     .addEventListener('change', ceremonialBeltSetup);

function inputUpdate() {
     inputSetup();
     parentSetup();

     // console.log(input);
     // console.log(sire, dam);
}

inputUpdate();

// setup 'foal' object
// old foal = foal.geno
function foalSetup() {
     window.foal = {
          warning: [],
          geno: {
               final: [],
               main: {
                    final: [],
                    base: [],
                    rarities: [],
               },
               chimera: {
                    final: [],
                    base: [],
                    rarities: [],
               },
          },
          pheno: {
               final: [],
               main: {
                    final: [],
                    base: [],
                    rarities: [],
                    carries: [],
               },
               chimera: {
                    final: [],
                    base: [],
                    rarities: [],
                    carries: [],
               },
               mutations: [],
          },
          stats: [],
          health: [],
          gender: '',
          type: '',
     };
     // console.log(foal);
}

// TODO: refactor rollStats, still long-winded and assumes formatting too much
function rollStats() {
     function rngStats(x) {
          if (input.charmOfSuccess) x = x * 2;
          let roll = Math.floor(Math.random() * x);
          return roll;
     }

     function logicStats() {
          let sstat = sire.stats.match(/(\d\d\b|\d\b)/g);
          let ssp = parseInt(sstat[0], 10);
          let sst = parseInt(sstat[1], 10);
          let ssm = parseInt(sstat[2], 10);
          let sin = parseInt(sstat[3], 10);
          let sag = parseInt(sstat[4], 10);
          let svi = parseInt(sstat[5], 10);

          let dstat = dam.stats.match(/(\d\d\b|\d\b)/g);
          let dsp = parseInt(dstat[0], 10);
          let dst = parseInt(dstat[1], 10);
          let dsm = parseInt(dstat[2], 10);
          let din = parseInt(dstat[3], 10);
          let dag = parseInt(dstat[4], 10);
          let dvi = parseInt(dstat[5], 10);

          foal.stats[0] = ssp > dsp ? rngStats(ssp) : rngStats(dsp);
          foal.stats[1] = sst > dst ? rngStats(sst) : rngStats(dst);
          foal.stats[2] = ssm > dsm ? rngStats(ssm) : rngStats(dsm);
          foal.stats[3] = sin > din ? rngStats(sin) : rngStats(din);
          foal.stats[4] = sag > dag ? rngStats(sag) : rngStats(dag);
          foal.stats[5] = svi > dvi ? rngStats(svi) : rngStats(dvi);
     }

     function addPendantOfTheAncestors() {
          let x = rng(6);
          if (x === 1) {
               foal.stats[0] += 5;
          } else if (x === 2) {
               foal.stats[1] += 5;
          } else if (x === 3) {
               foal.stats[2] += 5;
          } else if (x === 4) {
               foal.stats[3] += 5;
          } else if (x === 5) {
               foal.stats[4] += 5;
          } else if (x === 6) {
               foal.stats[5] += 5;
          }
     }

     function fixStats() {
          foal.stats[0] = isNaN(foal.stats[0]) === true ? '?' : foal.stats[0];
          foal.stats[1] = isNaN(foal.stats[1]) === true ? '?' : foal.stats[1];
          foal.stats[2] = isNaN(foal.stats[2]) === true ? '?' : foal.stats[2];
          foal.stats[3] = isNaN(foal.stats[3]) === true ? '?' : foal.stats[3];
          foal.stats[4] = isNaN(foal.stats[4]) === true ? '?' : foal.stats[4];
          foal.stats[5] = isNaN(foal.stats[5]) === true ? '?' : foal.stats[5];
     }

     if (sire.stats != '' && dam.stats != '') {
          logicStats();
          if (input.pendantOfTheAncestors === true) {
               addPendantOfTheAncestors();
          }
          fixStats();
     } else {
          foal.stats[0] = '?';
          foal.stats[1] = '?';
          foal.stats[2] = '?';
          foal.stats[3] = '?';
          foal.stats[4] = '?';
          foal.stats[5] = '?';
     }
}

function rollGender() {
     const x = rng(100);

     if ((foalNum === 1 && input.tarotCard === 'stallion') || x >= 51) {
          foal.gender = 'stallion';
     } else if ((foalNum === 1 && input.tarotCard === 'mare') || x <= 50) {
          foal.gender = 'mare';
     }
}

function rollType() {
     //console.log(sire.type, dam.type);
     if (sire.type === 'jibita pony' && dam.type === 'jibita pony') {
          foal.type = 'jibita pony';
     } else if (
          (sire.type === 'jibita pony' && dam.type === 'haspar draft') ||
          (sire.type === 'haspar draft' && dam.type === 'jibita pony')
     ) {
          let ponyChance = 60;
          if (input.buildItems === 'medium tonic') ponyChance = 80;
          else if (input.buildItems === 'heavy tonic') ponyChance = 20;

          if (rng(100) <= ponyChance) {
               foal.type = 'jibita pony';
          } else {
               foal.type = 'haspar draft';
          }
     } else if (
          (sire.type === 'jibita pony' && dam.type === 'tatakh mini') ||
          (sire.type === 'tatakh mini' && dam.type === 'jibita pony')
     ) {
          if (input.buildItems === 'light tonic') {
               if (rng(100) <= 80) {
                    foal.type = 'jibita pony';
               } else {
                    foal.type = 'tatakh mini';
               }
          } else {
               foal.type = 'illegal type cross!';
          }
     } else if (sire.type === 'haspar draft' && dam.type === 'haspar draft') {
          foal.type = 'haspar draft';
     } else if (
          (sire.type === 'haspar draft' && dam.type === 'tatakh mini') ||
          (sire.type === 'tatakh mini' && dam.type === 'haspar draft')
     ) {
          foal.type = 'illegal type cross!';
     } else if (sire.type === 'tatakh mini' && dam.type === 'tatakh mini') {
          foal.type = 'tatakh mini';
     }
}

function rollInbred() {
     let twins = foalNum === 2 ? true : false;

     function rollhealth() {
          function rolldefects() {
               let x = rng(100);

               if (x <= 10) {
                    foal.health.push('partial blindness');
               } else if (x <= 20) {
                    foal.health.push('blind');
               } else if (x <= 30) {
                    foal.health.push('partial deafness');
               } else if (x <= 40) {
                    foal.health.push('deaf');
               } else if (x <= 45) {
                    foal.health.push('mute');
               } else if (x <= 50) {
                    foal.health.push('spinal deformity');
               } else if (x <= 55) {
                    foal.health.push('overbite/underbite');
               } else if (x <= 60) {
                    foal.health.push('mane/tail baldness');
               } else if (x <= 65) {
                    foal.health.push('extreme hoof growth');
               } else if (x <= 70) {
                    foal.health.push('weak bones');
               } else if (x <= 75) {
                    foal.health.push('respiratory weakness');
               } else if (x <= 80) {
                    foal.health.push('benign growths');
               } else if (x <= 85) {
                    foal.health.push('vascular disease');
               } else if (x <= 90) {
                    foal.health.push('nerve sensitivity');
               } else if (x <= 95) {
                    foal.health.push('weakened immune system');
               } else if (x <= 97) {
                    foal.health.push('infertile');
               } else if (x <= 100) {
                    foal.health = ['stillborn'];
               }
          }

          let x = rng(100);

          if (twins === true) {
               if (x <= 60) {
                    foal.health.push('healthy');
               } else if (x <= 80) {
                    rolldefects();
               } else if (x <= 90) {
                    rolldefects();
                    rolldefects();
               } else if (x <= 100) {
                    rolldefects();
                    rolldefects();
                    rolldefects();
               }
          } else if (twins === false) {
               if (x <= 70) {
                    foal.health.push('healthy');
               } else if (x <= 80) {
                    rolldefects();
               } else if (x <= 90) {
                    rolldefects();
                    rolldefects();
               } else if (x <= 100) {
                    rolldefects();
                    rolldefects();
                    rolldefects();
               }
          }
     }

     if (
          input.fertilitySupplement === true ||
          input.tortoiseCompanion === true ||
          input.rankHorse === 'veteran'
     ) {
          foal.health.push('healthy');
     } else if (input.charmOfHealth) {
          charmOfHealthTriggered = true;
          foal.health.push('healthy');
     } else if (input.inbred === true) {
          rollhealth();
     } else if (
          (input.rankRider === 'untrained' && twins === true) ||
          (input.rankRider === 'initiate' && twins === true) ||
          (input.rankRider === 'rookie' && twins === true)
     ) {
          rollhealth();
     } else if (input.noviceTwins === true && twins === true) {
          rollhealth();
     } else {
          foal.health.push('healthy');
     }
}

function rollCoat(pathGeno) {
     // set dom, rec, cloak, geneA and geneB scope
     let dom = '';
     let rec = '';
     let absent = '';
     let cloak = '';
     let geneA = false;
     let geneB = false;

     function logicBlack() {
          function rollAgain() {
               dom = 'EE';
               rec = 'Ee';
               absent = 'ee';
               let regEx = /\b(E|e)(E|e)\b/;

               geneA =
                    sire.geno.match(regEx) !== null
                         ? sire.geno.match(regEx)[0]
                         : false;
               geneB =
                    dam.geno.match(regEx) !== null
                         ? dam.geno.match(regEx)[0]
                         : false;
               // console.log(geneA, geneB);

               if (geneA !== false && geneB !== false) {
                    let x = rng(100);

                    pathGeno.base.pop();

                    if (geneA === dom && geneB === dom) {
                         // dom x dom
                         pathGeno.base.push(dom);
                    } else if (
                         (geneA === dom && geneB === rec) ||
                         (geneA === rec && geneB === dom)
                    ) {
                         // dom x rec
                         if (x <= 80) {
                              pathGeno.base.push(rec);
                         } else if (x <= 100) {
                              pathGeno.base.push(dom);
                         }
                    } else if (
                         (geneA === dom && geneB === absent) ||
                         (geneA === absent && geneB === dom)
                    ) {
                         // dom x absent
                         if (x <= 80) {
                              pathGeno.base.push(rec);
                         } else if (x <= 95) {
                              pathGeno.base.push(dom);
                         } else if (x <= 100) {
                              pathGeno.base.push(absent);
                         }
                    } else if (geneA === rec && geneB === rec) {
                         // rec x rec
                         if (x <= 80) {
                              pathGeno.base.push(rec);
                         } else if (x <= 85) {
                              pathGeno.base.push(dom);
                         } else if (x <= 100) {
                              pathGeno.base.push(absent);
                         }
                    } else if (
                         (geneA === rec && geneB === absent) ||
                         (geneA === absent && geneB === rec)
                    ) {
                         // rec x absent
                         if (x <= 60) {
                              pathGeno.base.push(rec);
                         } else if (x <= 100) {
                              pathGeno.base.push(absent);
                         }
                    } else if (geneA === absent && geneB === absent) {
                         // absent x absent
                         if (x <= 100) {
                              pathGeno.base.push(absent);
                         }
                    }
               } else {
                    foal.warning = 'black missing, inaccurate parent geno';
                    pathGeno.base.push('??');
               }
          }

          rollAgain();
          while (
               input.ceremonialBelt === 'chestnut' &&
               !pathGeno.base.checkGene(/ee/)
          ) {
               rollAgain();
          }
          while (
               input.ceremonialBelt === 'bay' &&
               !pathGeno.base.checkGene(/E(E|e)/)
          ) {
               rollAgain();
          }
          while (
               input.ceremonialBelt === 'mealy' &&
               !pathGeno.base.checkGene(/E(E|e)/)
          ) {
               rollAgain();
          }
          while (
               input.ceremonialBelt === 'wild bay' &&
               !pathGeno.base.checkGene(/E(E|e)/)
          ) {
               rollAgain();
          }
          while (
               input.ceremonialBelt === 'black' &&
               !pathGeno.base.checkGene(/E(E|e)/)
          ) {
               rollAgain();
          }
     }

     function logicAgouti() {
          function rollAgain() {
               let regEx = /\b(A|At|Aw|a)(A|At|Aw|a)\b/;

               // console.log(sire.geno, dam.geno);
               geneA =
                    sire.geno.match(regEx) !== null
                         ? sire.geno.match(regEx)[0]
                         : false;
               geneB =
                    dam.geno.match(regEx) !== null
                         ? dam.geno.match(regEx)[0]
                         : false;
               console.log(geneA, geneB);

               function logicAgouti() {
                    for (let i = 0; i < dictAgouti.length; i++) {
                         if (
                              (geneA === dictAgouti[i][0] &&
                                   geneB === dictAgouti[i][1]) ||
                              (geneA === dictAgouti[i][1] &&
                                   geneB === dictAgouti[i][0])
                         ) {
                              pathGeno.base.push(randomizer(dictAgouti[i][2]));
                              return;
                         }
                    }
               }

               if (geneA !== false && geneB !== false) {
                    logicAgouti();
               } else {
                    // TODO: change foal.warning to array instead of string
                    foal.warning = 'agouti missing, inaccurate parent geno';
                    pathGeno.base.push('??');
               }
          }

          rollAgain();
          while (
               input.ceremonialBelt === 'chestnut' &&
               !pathGeno.base.checkGene(/(A|At|Aw|a)(A|At|Aw|a)/)
          ) {
               console.log('chestnut');
               rollAgain();
          }
          while (
               input.ceremonialBelt === 'bay' &&
               !pathGeno.base.checkGene(/(A)(A|a)/)
          ) {
               console.log('bay');
               rollAgain();
          }
          while (
               input.ceremonialBelt === 'mealy' &&
               !pathGeno.base.checkGene(/(At)(A|At|a)/)
          ) {
               console.log('mealy');
               rollAgain();
          }
          while (
               input.ceremonialBelt === 'wild bay' &&
               !pathGeno.base.checkGene(/(Aw)(A|Aw|a)/)
          ) {
               console.log('wild bay');
               rollAgain();
          }
          while (
               input.ceremonialBelt === 'black' &&
               !pathGeno.base.checkGene(/aa/)
          ) {
               console.log('black');
               rollAgain();
          }
     }

     // set dom, rec, cloak, geneA and geneB variables
     function logicPrepareGene(gene) {
          colour = gene[0];
          dom = gene[1] + gene[1];
          rec = 'n' + gene[1];
          cloak = gene[0];
          headpiece = gene[0];
          let regEx = '\\b(' + dom + '|' + rec + ')\\b';
          regEx = new RegExp(regEx, '');
          // console.log(regEx);

          geneA =
               sire.geno.match(regEx) !== null
                    ? sire.geno.match(regEx)[0]
                    : false;
          geneB =
               dam.geno.match(regEx) !== null
                    ? dam.geno.match(regEx)[0]
                    : false;
          // console.log(geneA, geneB);
     }

     function logicCommon(gene) {
          logicPrepareGene(gene);

          if (input.ceremonialHeadpiece === headpiece && !headpieceTriggered) {
               headpieceTriggered = true;
               return;
          }

          if (geneA !== false || geneB !== false) {
               let x = rng(100);

               if (geneA === dom && geneB === dom) {
                    // dom x dom
                    if (x <= 100) {
                         pathGeno.rarities.push(dom);
                    }
               } else if (
                    (geneA === dom && geneB === rec) ||
                    (geneA === rec && geneB === dom)
               ) {
                    // dom x rec
                    if (x <= 60) {
                         pathGeno.rarities.push(rec);
                    } else if (x <= 100) {
                         pathGeno.rarities.push(dom);
                    }
               } else if (
                    (geneA === dom && geneB === false) ||
                    (geneA === false && geneB === dom)
               ) {
                    // dom x none
                    if (x <= 65) {
                         pathGeno.rarities.push(rec);
                    } else if (x <= 80) {
                         pathGeno.rarities.push(dom);
                    } else if (input.furCloak === cloak && !cloakTriggered) {
                         pathGeno.rarities.push(rec);
                         cloakTriggered = true;
                    }
               } else if (geneA === rec && geneB === rec) {
                    // rec x rec
                    if (x <= 65) {
                         pathGeno.rarities.push(rec);
                    } else if (x <= 80) {
                         pathGeno.rarities.push(dom);
                    } else if (input.furCloak === cloak && !cloakTriggered) {
                         pathGeno.rarities.push(rec);
                         cloakTriggered = true;
                    }
               } else if (
                    (geneA === rec && geneB === false) ||
                    (geneA === false && geneB === rec)
               ) {
                    // rec x none
                    if (x <= 50) {
                         pathGeno.rarities.push(rec);
                    } else if (input.furCloak === cloak && !cloakTriggered) {
                         pathGeno.rarities.push(rec);
                         cloakTriggered = true;
                    }
               }

               if (input.ceremonialMask === gene[0] && rng(100) <= 15) {
                    ceremonialMaskTriggered = true;
                    if (pathGeno.rarities.includes(rec)) {
                         pathGeno.rarities.pop();
                         pathGeno.rarities.push(dom);
                    } else if (
                         !pathGeno.rarities.includes(dom) &&
                         !pathGeno.rarities.includes(rec)
                    ) {
                         pathGeno.rarities.push(dom);
                    }
               }
          }

          // console.log(pathGeno.rarities);
     }

     function logicUncommon(gene) {
          logicPrepareGene(gene);

          if (input.ceremonialHeadpiece === headpiece && !headpieceTriggered) {
               headpieceTriggered = true;
               return;
          }

          if (geneA !== false || geneB !== false) {
               let x = rng(100);

               if (geneA === dom && geneB === dom) {
                    // dom x dom
                    if (x <= 100) {
                         pathGeno.rarities.push(dom);
                    }
               } else if (
                    (geneA === dom && geneB === rec) ||
                    (geneA === rec && geneB === dom)
               ) {
                    // dom x rec
                    if (x <= 85) {
                         pathGeno.rarities.push(rec);
                    } else if (x <= 100) {
                         pathGeno.rarities.push(dom);
                    }
               } else if (
                    (geneA === dom && geneB === false) ||
                    (geneA === false && geneB === dom)
               ) {
                    // dom x none
                    if (x <= 45) {
                         pathGeno.rarities.push(rec);
                    } else if (x <= 50) {
                         pathGeno.rarities.push(dom);
                    } else if (input.furCloak === cloak && !cloakTriggered) {
                         pathGeno.rarities.push(rec);
                         cloakTriggered = true;
                    }
               } else if (geneA === rec && geneB === rec) {
                    // rec x rec
                    if (x <= 45) {
                         pathGeno.rarities.push(rec);
                    } else if (x <= 50) {
                         pathGeno.rarities.push(dom);
                    } else if (input.furCloak === cloak && !cloakTriggered) {
                         pathGeno.rarities.push(rec);
                         cloakTriggered = true;
                    }
               } else if (
                    (geneA === rec && geneB === false) ||
                    (geneA === false && geneB === rec)
               ) {
                    // rec x none
                    if (x <= 30) {
                         pathGeno.rarities.push(rec);
                    } else if (input.furCloak === cloak && !cloakTriggered) {
                         pathGeno.rarities.push(rec);
                         cloakTriggered = true;
                    }
               }

               charmOfHealthDowngrade(pathGeno, dom, rec);

               if (input.ceremonialMask === gene[0] && rng(100) <= 10) {
                    ceremonialMaskTriggered = true;
                    if (pathGeno.rarities.includes(rec)) {
                         pathGeno.rarities.pop();
                         pathGeno.rarities.push(dom);
                    } else if (
                         !pathGeno.rarities.includes(dom) &&
                         !pathGeno.rarities.includes(rec)
                    ) {
                         pathGeno.rarities.push(dom);
                    }
               }
          }

          // console.log(pathGeno.rarities);
     }

     function logicRare(gene) {
          function rareHealth() {
               let x = rng(100);
               if (x <= 25) {
                    foal.health.push('infertile');
               } else if (x <= 100) {
                    foal.health = ['stillborn'];
               }
          }

          logicPrepareGene(gene);

          if (input.ceremonialHeadpiece === headpiece && !headpieceTriggered) {
               headpieceTriggered = true;
               return;
          }

          if (geneA !== false || geneB !== false) {
               let x = rng(100);
               let warning = dom + 'not viable, inaccurate parent geno';

               if (geneA === dom && geneB === dom) {
                    // dom x dom
                    foal.warning = warning;
               } else if (
                    (geneA === dom && geneB === rec) ||
                    (geneA === rec && geneB === dom)
               ) {
                    // dom x rec
                    foal.warning = warning;
               } else if (
                    (geneA === dom && geneB === false) ||
                    (geneA === false && geneB === dom)
               ) {
                    // dom x none
                    foal.warning = warning;
               } else if (geneA === rec && geneB === rec) {
                    // rec x rec
                    if (x <= 40) {
                         pathGeno.rarities.push(rec);
                    } else if (x <= 45) {
                         pathGeno.rarities.push(dom);
                         rareHealth();
                    } else if (input.furCloak === cloak && !cloakTriggered) {
                         pathGeno.rarities.push(rec);
                         cloakTriggered = true;
                    }
               } else if (
                    (geneA === rec && geneB === false) ||
                    (geneA === false && geneB === rec)
               ) {
                    // rec x none
                    if (x <= 25) {
                         pathGeno.rarities.push(rec);
                    } else if (input.furCloak === cloak && !cloakTriggered) {
                         pathGeno.rarities.push(rec);
                         cloakTriggered = true;
                    }
               }

               charmOfHealthDowngrade(pathGeno, dom, rec);

               if (input.ceremonialMask === gene[0] && rng(100) <= 15) {
                    ceremonialMaskTriggered = true;
                    if (pathGeno.rarities.includes(rec)) {
                         pathGeno.rarities.pop();
                         pathGeno.rarities.push(dom);
                    } else if (
                         !pathGeno.rarities.includes(dom) &&
                         !pathGeno.rarities.includes(rec)
                    ) {
                         pathGeno.rarities.push(dom);
                    }
               }
          }

          // console.log(foal.geno);
     }

     /*
  let test = genes.common[0];
  // console.log(test);
  logicCommon(test);
  */

     // if (input.ceremonialBelt !== 'n/a') {
     // 	console.log('ceremonial belt triggered');

     // 	if (input.ceremonialBelt === 'chestnut') {
     // 		pathGeno.base.push('ee');
     // 		pathGeno.base.push(randomizer(['AA','AtAt','Ata','A+A+','AA+','Aa','aa']));
     // 	}
     // 	else if (input.ceremonialBelt === 'mealy') {
     // 		pathGeno.base.push(randomizer(['EE','Ee']));
     // 		pathGeno.base.push(randomizer(['AtAt','Ata']));
     // 	}
     // 	else if (input.ceremonialBelt === 'wild bay') {
     // 		pathGeno.base.push(randomizer(['EE','Ee']));
     // 		pathGeno.base.push(randomizer(['A+A+','A+a']));
     // 	}
     // 	else if (input.ceremonialBelt === 'bay') {
     // 		pathGeno.base.push(randomizer(['EE','Ee']));
     // 		pathGeno.base.push(randomizer(['AA','Aa']));
     // 	}
     // 	else if (input.ceremonialBelt === 'black') {
     // 		pathGeno.base.push(randomizer(['EE','Ee']));
     // 		pathGeno.base.push('aa');
     // 	}
     // }
     // else {
     // 	logicBlack();
     // 	logicAgouti();
     // }
     logicBlack();
     logicAgouti();
     for (let i = 0; i < genes.common.length; i++) {
          logicCommon(genes.common[i]);
     }
     for (let i = 0; i < genes.uncommon.length; i++) {
          logicUncommon(genes.uncommon[i]);
     }
     for (let i = 0; i < genes.rare.length; i++) {
          logicRare(genes.rare[i]);
     }

     // console.log(pathGeno);
}

function readPheno(pathGeno, pathPheno) {
     let tempGenoBase = pathGeno.base.join();
     console.log(tempGenoBase);
     if (tempGenoBase.search(/ee,(A|At|Aw|a)(A|At|Aw|a)/) !== -1) {
          pathPheno.base.push('chestnut');
     } else if (
          tempGenoBase.search(/E(E|e),(AtAt|AtAw|Ata|AtA|AAt|AwAt)/) !== -1
     ) {
          pathPheno.base.push('mealy');
     } else if (tempGenoBase.search(/E(E|e),(AAw|AwA|Awa|AwAw)/) !== -1) {
          pathPheno.base.push('wild bay');
     } else if (tempGenoBase.search(/E(E|e),(A)(A|a)/) !== -1) {
          pathPheno.base.push('bay');
     } else if (tempGenoBase.search(/E(E|e),aa/) !== -1) {
          pathPheno.base.push('black');
     }

     function logicPheno(path, gene) {
          let output = '';
          let colour = gene[0];
          let dom = gene[1] + gene[1];
          let rec = 'n' + gene[1];

          if (path.includes(dom) === true || path.includes(rec) === true) {
               output = colour;
          }
          // console.log(output);
          return output;
     }

     for (let i = 0; i < genes.common.length; i++) {
          let output = logicPheno(pathGeno.rarities, genes.common[i]);
          if (output !== '') {
               pathPheno.rarities.push(output);
          }
     }
     for (let i = 0; i < genes.uncommon.length; i++) {
          let output = logicPheno(pathGeno.rarities, genes.uncommon[i]);
          if (output !== '') {
               pathPheno.rarities.push(output);
          }
     }
     for (let i = 0; i < genes.rare.length; i++) {
          let output = logicPheno(pathGeno.rarities, genes.rare[i]);
          if (output !== '') {
               pathPheno.rarities.push(output);
          }
     }

     function phenoExceptions() {
          let tempFoal =
               pathGeno.base.join(' ') + ' ' + pathGeno.rarities.join(' ');
          // console.log(tempFoal);

          // declare variables for colour indexOf numbers
          let chestnut = 0;
          let black = 0;
          let champagne = 0;
          let cream = 0;
          let dun = 0;
          let flaxen = 0;
          let pearl = 0;
          let silver = 0;

          //pearl
          if (tempFoal.search(/\b(nPr)\b/) !== -1) {
               silver = pathPheno.rarities.indexOf('pearl');
               pathPheno.rarities.splice(silver, 1);
               pathPheno.carries.push('pearl');
          }

          //flaxen
          if (
               tempFoal.search(/\b(nFl|FlFl)\b/) !== -1 &&
               pathPheno.base.indexOf('chestnut') === -1
          ) {
               flaxen = pathPheno.rarities.indexOf('flaxen');
               pathPheno.rarities.splice(flaxen, 1);
               pathPheno.carries.push('flaxen');
          } else if (tempFoal.search(/\b(FlFl)\b/) !== -1) {
               flaxen = pathPheno.rarities.indexOf('flaxen');
               pathPheno.rarities.splice(flaxen, 1);
               pathPheno.base.unshift('flaxen');
          }

          //silver
          if (
               tempFoal.search(/\b(nSv|SvSv)\b/) !== -1 &&
               pathPheno.base.indexOf('chestnut') !== -1
          ) {
               silver = pathPheno.rarities.indexOf('silver');
               pathPheno.rarities.splice(silver, 1);
               pathPheno.carries.push('silver');
          } else if (tempFoal.search(/\b(nSv|SvSv)\b/) !== -1) {
               silver = pathPheno.rarities.indexOf('silver');
               pathPheno.rarities.splice(silver, 1);
               pathPheno.base.unshift('silver');
          }

          // TODO: make exception logic more performant by checking base instead of running if trees for every base
          //chestnut base
          chestnut = pathPheno.base.indexOf('chestnut');
          dun = pathPheno.rarities.indexOf('dun');
          cream = pathPheno.rarities.indexOf('cream');
          champagne = pathPheno.rarities.indexOf('champagne');

          if (
               chestnut !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(CrCr)\b/) !== -1
          ) {
               pathPheno.base[chestnut] = 'ivory cremello dun champagne';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               chestnut !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(nCr)\b/) !== -1
          ) {
               pathPheno.base[chestnut] = 'ivory dunalino champagne';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               chestnut !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(CrCr)\b/) !== -1
          ) {
               pathPheno.base[chestnut] = 'ivory cream champagne';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               chestnut !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(nCr)\b/) !== -1
          ) {
               pathPheno.base[chestnut] = 'ivory champagne';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               chestnut !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1
          ) {
               pathPheno.base[chestnut] = 'gold dun';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               chestnut !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(CrCr)\b/) !== -1
          ) {
               pathPheno.base[chestnut] = 'cremello dun';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
          } else if (
               chestnut !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCr)\b/) !== -1
          ) {
               pathPheno.base[chestnut] = 'dunalino';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
          } else if (
               chestnut !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1
          ) {
               pathPheno.base[chestnut] = 'red dun';
               pathPheno.rarities[dun] = '';
          } else if (chestnut !== -1 && tempFoal.search(/\b(CrCr)\b/) !== -1) {
               pathPheno.base[chestnut] = 'cremello';
               pathPheno.rarities[cream] = '';
          } else if (chestnut !== -1 && tempFoal.search(/\b(nCr)\b/) !== -1) {
               pathPheno.base[chestnut] = 'palomino';
               pathPheno.rarities[cream] = '';
          } else if (
               chestnut !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1
          ) {
               pathPheno.base[chestnut] = 'gold champagne';
               pathPheno.rarities[champagne] = '';
          }

          //black base
          black = pathPheno.base.indexOf('black');
          dun = pathPheno.rarities.indexOf('dun');
          cream = pathPheno.rarities.indexOf('cream');
          champagne = pathPheno.rarities.indexOf('champagne');
          silver = pathPheno.base.indexOf('silver');

          if (
               black !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(CrCr)\b/) !== -1
          ) {
               pathPheno.base[black] = 'smoky ivory mouse dun';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               black !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(nCr)\b/) !== -1
          ) {
               pathPheno.base[black] = 'smoky mouse dun';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               black !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(CrCr)\b/) !== -1
          ) {
               pathPheno.base[black] = 'classic cream ivory';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               black !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(nCr)\b/) !== -1
          ) {
               pathPheno.base[black] = 'classic ivory';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               black !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1
          ) {
               pathPheno.base[black] = 'mouse dun';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               black !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(CrCr)\b/) !== -1
          ) {
               pathPheno.base[black] = 'smoky cream grullo';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
          } else if (
               black !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCr)\b/) !== -1
          ) {
               pathPheno.base[black] = 'smoky grullo';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
          } else if (black !== -1 && tempFoal.search(/\b(nDn|DnDn)\b/) !== -1) {
               pathPheno.base[black] = 'grullo';
               pathPheno.rarities[dun] = '';
          } else if (black !== -1 && tempFoal.search(/\b(CrCr)\b/) !== -1) {
               pathPheno.base[black] = 'smoky cream';
               pathPheno.rarities[cream] = '';
          } else if (black !== -1 && tempFoal.search(/\b(nCr)\b/) !== -1) {
               pathPheno.base[black] = 'smoky black';
               pathPheno.rarities[cream] = '';
          } else if (black !== -1 && tempFoal.search(/\b(nCh|ChCh)\b/) !== -1) {
               pathPheno.base[black] = 'classic champagne';
               pathPheno.rarities[champagne] = '';
          } else if (black !== -1 && tempFoal.search(/\b(nSv|SvSv)\b/) !== -1) {
               pathPheno.base[black] = 'silver dapple';
               pathPheno.base[silver] = '';
          }

          //bay base
          bay = pathPheno.base.indexOf('bay');
          dun = pathPheno.rarities.indexOf('dun');
          cream = pathPheno.rarities.indexOf('cream');
          champagne = pathPheno.rarities.indexOf('champagne');
          silver = pathPheno.base.indexOf('silver');

          if (
               bay !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(CrCr)\b/) !== -1
          ) {
               pathPheno.base[bay] = 'amber ivory dunskin';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               bay !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(nCr)\b/) !== -1
          ) {
               pathPheno.base[bay] = 'amber dunskin';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               bay !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(CrCr)\b/) !== -1
          ) {
               pathPheno.base[bay] = 'amber cream ivory';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               bay !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(nCr)\b/) !== -1
          ) {
               pathPheno.base[bay] = 'amber ivory';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               bay !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1
          ) {
               pathPheno.base[bay] = 'amber dun';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               bay !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(CrCr)\b/) !== -1
          ) {
               pathPheno.base[bay] = 'cream dunskin';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
          } else if (
               bay !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCr)\b/) !== -1
          ) {
               pathPheno.base[bay] = 'dunskin';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
          } else if (bay !== -1 && tempFoal.search(/\b(nDn|DnDn)\b/) !== -1) {
               pathPheno.base[bay] = 'classic dun';
               pathPheno.rarities[dun] = '';
          } else if (bay !== -1 && tempFoal.search(/\b(CrCr)\b/) !== -1) {
               pathPheno.base[bay] = 'perlino';
               pathPheno.rarities[cream] = '';
          } else if (bay !== -1 && tempFoal.search(/\b(nCr)\b/) !== -1) {
               pathPheno.base[bay] = 'buckskin';
               pathPheno.rarities[cream] = '';
          } else if (bay !== -1 && tempFoal.search(/\b(nCh|ChCh)\b/) !== -1) {
               pathPheno.base[bay] = 'amber champagne';
               pathPheno.rarities[champagne] = '';
          } else if (bay !== -1 && tempFoal.search(/\b(nSv|SvSv)\b/) !== -1) {
               pathPheno.base[bay] = 'silver bay';
               pathPheno.base[silver] = '';
          }

          //wild bay base
          wildBay = pathPheno.base.indexOf('wild bay');
          dun = pathPheno.rarities.indexOf('dun');
          cream = pathPheno.rarities.indexOf('cream');
          champagne = pathPheno.rarities.indexOf('champagne');
          silver = pathPheno.base.indexOf('silver');

          if (
               wildBay !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(CrCr)\b/) !== -1
          ) {
               pathPheno.base[wildBay] = 'amber ivory dunskin';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               wildBay !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(nCr)\b/) !== -1
          ) {
               pathPheno.base[wildBay] = 'amber dunskin';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               wildBay !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(CrCr)\b/) !== -1
          ) {
               pathPheno.base[wildBay] = 'amber cream ivory';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               wildBay !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(nCr)\b/) !== -1
          ) {
               pathPheno.base[wildBay] = 'amber ivory';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               wildBay !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1
          ) {
               pathPheno.base[wildBay] = 'amber dun';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               wildBay !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(CrCr)\b/) !== -1
          ) {
               pathPheno.base[wildBay] = 'cream dunskin';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
          } else if (
               wildBay !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCr)\b/) !== -1
          ) {
               pathPheno.base[wildBay] = 'dunskin';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
          } else if (
               wildBay !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1
          ) {
               pathPheno.base[wildBay] = 'classic dun';
               pathPheno.rarities[dun] = '';
          } else if (wildBay !== -1 && tempFoal.search(/\b(CrCr)\b/) !== -1) {
               pathPheno.base[wildBay] = 'perlino';
               pathPheno.rarities[cream] = '';
          } else if (wildBay !== -1 && tempFoal.search(/\b(nCr)\b/) !== -1) {
               pathPheno.base[wildBay] = 'buckskin';
               pathPheno.rarities[cream] = '';
          } else if (
               wildBay !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1
          ) {
               pathPheno.base[wildBay] = 'amber champagne';
               pathPheno.rarities[champagne] = '';
          } else if (
               wildBay !== -1 &&
               tempFoal.search(/\b(nSv|SvSv)\b/) !== -1
          ) {
               pathPheno.base[wildBay] = 'silver wild bay';
               pathPheno.base[silver] = '';
          }

          //mealy base
          mealy = pathPheno.base.indexOf('mealy');
          dun = pathPheno.rarities.indexOf('dun');
          cream = pathPheno.rarities.indexOf('cream');
          champagne = pathPheno.rarities.indexOf('champagne');
          silver = pathPheno.base.indexOf('silver');

          if (
               mealy !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(CrCr)\b/) !== -1
          ) {
               pathPheno.base[mealy] = 'sable ivory dunskin';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               mealy !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(nCr)\b/) !== -1
          ) {
               pathPheno.base[mealy] = 'sable dunskin';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               mealy !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(CrCr)\b/) !== -1
          ) {
               pathPheno.base[mealy] = 'sable cream ivory';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               mealy !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1 &&
               tempFoal.search(/\b(nCr)\b/) !== -1
          ) {
               pathPheno.base[mealy] = 'sable ivory';
               pathPheno.rarities[cream] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               mealy !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCh|ChCh)\b/) !== -1
          ) {
               pathPheno.base[mealy] = 'sable dun';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[champagne] = '';
          } else if (
               mealy !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(CrCr)\b/) !== -1
          ) {
               pathPheno.base[mealy] = 'burnt cream dunskin';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
          } else if (
               mealy !== -1 &&
               tempFoal.search(/\b(nDn|DnDn)\b/) !== -1 &&
               tempFoal.search(/\b(nCr)\b/) !== -1
          ) {
               pathPheno.base[mealy] = 'burnt dunskin';
               pathPheno.rarities[dun] = '';
               pathPheno.rarities[cream] = '';
          } else if (mealy !== -1 && tempFoal.search(/\b(nDn|DnDn)\b/) !== -1) {
               pathPheno.base[mealy] = 'olive dun';
               pathPheno.rarities[dun] = '';
          } else if (mealy !== -1 && tempFoal.search(/\b(CrCr)\b/) !== -1) {
               pathPheno.base[mealy] = 'mealy perlino';
               pathPheno.rarities[cream] = '';
          } else if (mealy !== -1 && tempFoal.search(/\b(nCr)\b/) !== -1) {
               pathPheno.base[mealy] = 'burnt buckskin';
               pathPheno.rarities[cream] = '';
          } else if (mealy !== -1 && tempFoal.search(/\b(nCh|ChCh)\b/) !== -1) {
               pathPheno.base[mealy] = 'sable champagne';
               pathPheno.rarities[champagne] = '';
          } else if (mealy !== -1 && tempFoal.search(/\b(nSv|SvSv)\b/) !== -1) {
               pathPheno.base[mealy] = 'silver blue';
               pathPheno.base[silver] = '';
          }
     }

     phenoExceptions();
     // console.log(pathPheno.carries);
}

function rollMutations() {
     let cham = input.rainbowChameleon;

     if (cham.albino === true && rng(100) <= 20) {
          console.log('yas');
          foal.pheno.mutations.push('[Albino]');
     } else if (cham.melanistic === true && rng(100) <= 20) {
          foal.pheno.mutations.push('[Melanistic]');
     } else if (cham.chimeric === true && rng(100) <= 20) {
          foal.pheno.mutations.push('[Chimeric]');
     } else if (cham.brindle === true && rng(100) <= 20) {
          foal.pheno.mutations.push('[Brindle]');
     } else if (cham.vitiligo === true && rng(100) <= 20) {
          foal.pheno.mutations.push('[Vitiligo]');
     } else if (cham.somatic === true && rng(100) <= 20) {
          foal.pheno.mutations.push('[Somatic]');
     } else if (cham.blizzard === true && rng(100) <= 20) {
          foal.pheno.mutations.push('[Blizzard]');
     } else if (cham.paradox === true && rng(100) <= 20) {
          foal.pheno.mutations.push('[Paradox]');
     } else if (cham.caramel === true && rng(100) <= 20) {
          foal.pheno.mutations.push('[Caramel]');
     } else if (cham.marl === true && rng(100) <= 20) {
          foal.pheno.mutations.push('[Marl]');
     }

     let extraChance = 0;
     if (input.mysteriousMixture) extraChance += 7;
     if (rng(100) <= 3 + extraChance) {
          let x = rng(142);

          if (x <= 14) {
               foal.pheno.mutations.push('[Albino]');
          } else if (x <= 28) {
               foal.pheno.mutations.push('[Melanistic]');
          } else if (x <= 42) {
               foal.pheno.mutations.push('[Chimeric]');
          } else if (x <= 56) {
               foal.pheno.mutations.push('[Brindle]');
          } else if (x <= 70) {
               foal.pheno.mutations.push('[Vitiligo]');
          } else if (x <= 85) {
               foal.pheno.mutations.push('[Somatic]');
          } else if (x <= 100) {
               foal.pheno.mutations.push('[Blizzard]');
          } else if (x <= 114) {
               foal.pheno.mutations.push('[Paradox]');
          } else if (x <= 128) {
               foal.pheno.mutations.push('[Caramel]');
          } else if (x <= 142) {
               foal.pheno.mutations.push('[Marl]');
          }
     }

     foal.pheno.mutations = foal.pheno.mutations.filter(onlyUnique);
}

function sanitize() {
     // geno
     function genoFold(path) {
          let output;
          path.base = path.base.join('/');
          path.rarities = path.rarities.join('/');

          output = path.base;
          if (path.rarities.length !== 0) {
               output += ' + ' + path.rarities;
          }
          return output;
     }

     if (foal.geno.main.base.length !== 0) {
          foal.geno.main.final = genoFold(foal.geno.main);
          if (foal.geno.chimera.base.length !== 0) {
               foal.geno.chimera.final = genoFold(foal.geno.chimera);
          }

          foal.geno.final = foal.geno.main.final;
          if (typeof foal.geno.chimera.final === 'string') {
               foal.geno.final += ' // ' + foal.geno.chimera.final;
          }
     } else {
          foal.geno = 'n/a';
     }

     // pheno
     function phenoFold(path) {
          let output;

          output = path.base.filter(Boolean).join(' ');

          path.rarities = path.rarities.filter(Boolean);
          if (path.rarities.length !== 0) {
               path.rarities = path.rarities
                    .join(', ')
                    .replace(/(,\s)(?!.*\1)/, ' and ');
               output += ' with ' + path.rarities;
          }
          path.carries = path.carries.filter(Boolean);
          if (path.carries.length !== 0) {
               path.carries =
                    '(' +
                    capitalizeArr(path.carries)
                         .join(', ')
                         .replace(/(,\s)(?!.*\1)/, ' and ') +
                    ' carrier)';
               output += ' ' + path.carries;
          }

          return output.capitalizeStr();
     }

     if (foal.pheno.main.base.length !== 0) {
          let main = foal.pheno.main;
          let chimera = foal.pheno.chimera;
          // console.log(main, chimera);

          main.final = phenoFold(main);
          chimera.final = phenoFold(chimera);
          // console.log(main, chimera);

          foal.pheno.final = main.final;
          if (chimera.final.length !== 0) {
               foal.pheno.final += ' // ' + chimera.final;
          }
          if (foal.pheno.mutations.length !== 0) {
               foal.pheno.final += ' ' + foal.pheno.mutations.join(' ');
          }
     } else {
          foal.pheno.final = 'n/a';
     }

     // stats
     if (foal.stats.length !== 0) {
     } else {
          foal.stats = 'n/a';
     }

     // heatlh
     if (foal.health.length !== 0) {
          foal.health = foal.health.filter(onlyUnique);
          foal.health = capitalizeArr(foal.health);
     } else {
          foal.health = 'n/a';
     }

     // gender
     if (foal.gender !== '') {
          foal.gender = foal.gender.capitalizeStr();
     } else {
          foal.gender = 'n/a';
     }

     // type
     if (foal.type !== '') {
          foal.type = foal.type.capitalizeStr();
     } else {
          foal.type = 'n/a';
     }
}

function outputFoal(counter) {
     // console.log(counter);
     let id = 'foalOutput' + counter;

     foalSetup();
     rollStats();
     rollGender();
     rollType();
     rollInbred();
     rollCoat(foal.geno.main);
     readPheno(foal.geno.main, foal.pheno.main);
     rollMutations();
     if (foal.pheno.mutations.indexOf('[Chimeric]') !== -1) {
          rollCoat(foal.geno.chimera);
          readPheno(foal.geno.chimera, foal.pheno.chimera);
     }
     sanitize();

     document.getElementById(id).innerText =
          'Gender: ' +
          foal.gender +
          ' ' +
          foal.type +
          '\n' +
          'Physical Condition: ' +
          foal.health +
          '\n' +
          'Genotype: ' +
          foal.geno.final +
          '\n' +
          'Phenotype: ' +
          foal.pheno.final +
          '\n' +
          'Stats: ' +
          'SP ' +
          foal.stats[0] +
          ' | ST ' +
          foal.stats[1] +
          ' | SM ' +
          foal.stats[2] +
          ' | IN ' +
          foal.stats[3] +
          ' | AG ' +
          foal.stats[4] +
          ' | VI ' +
          foal.stats[5] +
          '\n\n';
}

function resetOutput() {
     let ele = document.getElementsByClassName('foalOutput');
     for (let i = 0; i < ele.length; i++) {
          ele[i].innerText = '';
     }
}

function buttonPress() {
     resetOutput();

     window.foalNum = 1;
     twinsChance = 0;

     // set twinChance
     if (input.ringOfBlessings === true || input.tortoiseCompanion === true) {
          if (input.ringOfBlessings && input.rankRider === 'rookie')
               twinsChance += 40;
          else if (input.ringOfBlessings) twinsChance += 30;
          else if (input.tortoiseCompanion) twinsChance += 20;
     }

     if (input.noviceTwins === true) {
          twinsChance += 10;
     } else if (input.rankHorse === 'veteran') {
          twinsChance += 20;
     }

     if (input.charmOfFortune) twinsChance = 100;
     //   console.log(twinsChance);

     window.cloakTriggered = false;
     window.headpieceTriggered = false;
     window.charmOfHealthTriggered = false;
     window.ceremonialMaskTriggered = false;

     // set foalNum
     if (rng(100) <= twinsChance) {
          foalNum = 2;
     } else {
          foalNum = 1;
     }
     // console.log(foalNum);

     // check if breeding failed else output foal
     // TODO: remember to un-comment testing change
     let untrainedFailChance = 75;
     if (input.heirloomCurryComb) untrainedFailChance = 25;
     if (
          (input.rankRider === 'untrained' &&
               rng(100) <= untrainedFailChance) ||
          (input.rankRider === 'initiate' && rng(100) <= 25)
     ) {
          document.getElementById('foalOutput1').innerHTML =
               'Breeding Failed\n\n';
     } else {
          for (let i = 1; i <= foalNum; i++) {
               outputFoal(i);
          }
     }
}

// testing overrides
// document.getElementById('rankRider').value = 'rookie';
// document.getElementById('rankHorse').value = 'veteran';
// inputUpdate();

</script>